(function(f){var B=document,e=window,n=Math,v={treeField:"",width:800,height:500,oddevenrow:false,treeCheckBox:false,treeRadio:false,gridCheckBox:false,gridRadio:false,layout:{},forzenColumnsHeader:[],columnsHeader:[],allowMoveColumn:true,allowResizeColumn:true,rowNum:true,rowNumWidth:26,rowHover:true,gridCheckBoxWidth:26,onCellContentRender:function(){},onCellStyleRender:function(){},onLazyLoad:function(){},onRowClick:function(){},onRowDblClick:function(){},onSelect:function(){},onSelectAll:function(){},onExpand:function(){},datasource:function(){},resizeWidth:function(){},resizeHeight:function(){},footer:false,pager:null,onceRenderCount:50},i={pagesize:25,pageno:1,pagesize_list:[25,50,100]};var m="tgrid-cell-";function q(C){var E=[],D=C.layout;E.push('<div class="tgrid-view" style="width:',D.width,"px;height:",D.height,'px;">','<div class="tgrid-view1" style="width:',D.view1Width,'px">','<div class="tgrid-header" style="width:',D.view1Width,"px;height:",D.headerHeight,'px;">','<div class="tgrid-header-inner">',p(C,"view1"),"</div>","</div>",'<div class="tgrid-body" style="width:',D.view1Width,"px;height:",D.bodyHeight,'px">','<div class="tgrid-body-inner" ><div class="tgrid-table-wrap" ></div></div>',"</div>",'<div class="tgrid-footer" style="width:',D.view1Width,"px;display:",D.footerHeight===0?"none":"block",';">','<div class="tgrid-footer-inner" ></div>',"</div>","</div>",'<div class="tgrid-view2" style="width:',D.view2Width,'px">','<div class="tgrid-header" style="width:',D.view2Width,"px;height:",D.headerHeight,'px;">','<div class="tgrid-header-inner">',p(C,"view2"),"</div>","</div>",'<div class="tgrid-body" style="width:',D.view2Width,"px;height:",D.bodyHeight,'px">','<div class="tgrid-body-inner" ><div class="tgrid-table-wrap" ></div>',"</div></div>",'<div class="tgrid-footer" style="width:',D.view2Width,"px;display:",D.footerHeight===0?"none":"block",';">','<div class="tgrid-footer-inner"></div>',"</div>","</div>");E.push(d());if(C.pager){E.push('<div class="tgrid-pager-container"><div class="tgrid-pager"></div></div>')}if(C.allowResizeColumn){E.push(x())}E.push("</div>");return E.join("")}function s(F){var G=0,D=F.forzenColumnsHeader,C=D.length,H;if(C){H=D[C-1];for(var E=0;E<H.length;E++){G+=H[E].width}}return{width:F.width,height:F.height,view1Width:G,view2Width:F.width-G}}function l(){var D=f(B.createElement("div")).addClass("tgrid-view-tr-height-for-test").appendTo(B.body);var C=D.height();D.remove();return C}function z(){var D=f(B.createElement("div")).addClass("tgrid-view-theadtr-height-for-test").appendTo(B.body);var C=D.height();D.remove();return C}function A(C){var E=C.lineHeight?C.lineHeight:l(),H=C.headerLineHeight?C.headerLineHeight:z(),D=C.forzenColumnsHeader.length*H,G=0;C.lineHeight=E;C.headerLineHeight=H;if(C.footer){G=E}var F=D+(G===0?0:G+1);if(C.pager){F+=31}return{headerHeight:D-1,footerHeight:G,bodyHeight:C.height-F}}function p(F,O){var M=[],E;if(O==="view1"){E=F.forzenColumnsHeader}else{if(O==="view2"){E=F.columnsHeader}}M.push('<table cellspacing="0" cellpadding="0" border="0" class="tgrid-htable"><tbody>');for(var L=0,N=E.length;L<N;L++){M.push('<tr class="tgrid-header-row">');for(var I=0,J=E[L].length;I<J;I++){var H=E[L][I],D=H.field?H.field:"",K=m+D,P="",G=H.colspan?'colspan="'+H.colspan+'"':"";if(O==="view1"&&(D==="gridCheckBox__"||D==="gridRadio__")){if(D==="gridCheckBox__"&&L===N-1){P="checkbox-checkall"}M.push('<td class="tgrid-header-checkbox-radio-td"><div class="tgrid-header-checkbox-radio ');M.push(P," ",K,'"></div></td>');continue}if(O==="view1"&&D==="gridRowNum__"){M.push('<td class="tgrid-header-rownumber-td"><div class="tgrid-header-rownumber ',K,'"></div></td>');continue}var Q="",C="";if(F.allowResizeColumn&&D){Q='<span view="'+O+'" field="'+D+'" class="tgrid-resize-holder">&nbsp;</span>'}if(F.rowHover){C="onmouseenter=\"this.className+=' tgrid-header-over'\"";C+=" onmouseleave=\"this.className=this.className.replace(' tgrid-header-over','')\""}M.push('<td field="',D,'"',C,G,">",'<div class="tgrid-cell ',K,'" style="position:relative;text-align:center;" >',"<span>",H.name,"</span>",'<span class="tgrid-sort-icon">&nbsp;</span>',Q,"</div>","</td>")}M.push("</tr>")}M.push("</tbody></table>");return M.join("")}function b(E,C,D){var I=['<table cellspacing="0" cellpadding="0" border="0" class="tgrid-btable"><tbody>'],H=['<table cellspacing="0" cellpadding="0" border="0" class="tgrid-btable"><tbody>'];for(var F=0,G=E.length;F<G;F++){var K=C[E[F]],J=K._rowIndex_%2===0&&D.oddevenrow;I.push(o(K,D,J));H.push(c(K,D,J))}I.push("</tbody></table>");H.push("</tbody></table>");return{view1:I.join(""),view2:H.join("")}}function u(E,C,I,H){for(var F=0,G=E.length;F<G;F++){var J=E[F],K=E[F]._rowIndex_%2===0&&C.oddevenrow;I.push(o(J,C,K));H.push(c(J,C,K));var D=J.children;if(D){if(D.length){u(D,C,I,H)}}}}function o(J,D,O){var M=[],F=D.forzenColumnsHeader,P=O?"tgrid-oddevenrow":"",N=J.__show__===false;if(F.length===0){return}F=F[F.length-1];M.push('<tr id="',J.id,'view1" class="tgrid-row ',P,'" data-index="',J._stackIndex_,'" style="display:',N?"none":"",';">');for(var H=0;H<F.length;H++){var G=F[H].field,K=F[H].align,I=m+G,L,C=J[G]?J[G]:"";if(G===D.treeField){K="left";D.treeFieldPlace="view1"}if(G==="gridCheckBox__"){M.push('<td class="tgrid-checkbox-radio-td"><div class="tgrid-checkbox ',I,'"></div></td>')}else{if(G==="gridRadio__"){M.push('<td class="tgrid-checkbox-radio-td"><div class="tgrid-radio ',I,'"></div></td>')}else{if(G==="gridRowNum__"){M.push('<td class="tgrid-td-rownumber"><div class="',m,"rownumber ",I,'">',J._rowIndex_,"</div></td>")}else{var E=D.onCellStyleRender.call(null,C,J,G);M.push('<td field="',G,'" style="',E,'"><div class="tgrid-cell ',I,'" style="height:auto;text-align:',K,';">');L=D.onCellContentRender.call(null,C,J,G);C=L?L:C;if(D.treeField===G){M.push(r(J,C,D))}else{M.push(C)}M.push("</div></td>")}}}}M.push("</tr>");return M.join("")}function c(I,D,O){var M=[],P=O?"tgrid-oddevenrow":"",J=D.columnsHeader[D.columnsHeader.length-1],N=I.__show__===false;M.push('<tr id="',I.id,'view2" class="tgrid-row  ',P,'" data-index="',I._stackIndex_,'" style="display:',N?"none":"",';">');for(var G=0;G<J.length;G++){var F=J[G].field,K=J[G].align,L,H=m+F,C=I[F]?I[F]:"";if(F===D.treeField){K="left";D.treeFieldPlace="view2"}var E=D.onCellStyleRender.call(null,C,I,F);M.push('<td field="',F,'" style="',E,'"><div class="tgrid-cell ',H,'" style="height:auto;text-align:',K,';">');L=D.onCellContentRender.call(null,C,I,F);C=L?L:C;if(D.treeField===F){M.push(r(I,C,D))}else{M.push(C)}M.push("</div></td>")}M.push("</tr>");return M.join("")}function r(F,M,D){var H=[],J=0;if(typeof F._stackIndex_!=="undefined"){J=F._stackIndex_.split("_").length-2}for(var G=0;G<J;G++){H.push('<span class="tree-indent"></span>')}var K="",N=" tree-collapsed",I=D.treeCheckBox,E=D.treeRadio;if(F.isFolder||F.isLazy){K+=" tree-folder";if(F.isFolder&&F.expand!==false){K+=" tree-folder-open";N="tree-expanded"}if(F.isLazy&&!F.isFolder){N+=" tree-lazyload"}H.push('<span class="tree-hit ',N,'"></span>')}else{K+=" tree-file"}if(I){var C="";if(F.treeChecked){C="tree-checkbox-checked"}H.push('<span class="tree-checkbox ',C,'"></span>')}if(E){var L="";if(F.treeRadioChecked){L="tree-radio-checked"}H.push('<span class="tree-radio ',L,'"></span>')}H.push('<span class="tree-icon',K,'"></span>');H.push('<span class="tree-title">',M,"</span>");return H.join("")}function k(F,E){var D=['<table cellspacing="0" cellpadding="0" border="0" class="tgrid-btable"><tbody>'],C=['<table cellspacing="0" cellpadding="0" border="0" class="tgrid-btable"><tbody>'];if(!E.footer){return null}F=F[0];D.push(o(F,E));C.push(c(F,E));D.push("</tbody></table>");C.push("</tbody></table>");return{view1:D.join(""),view2:C.join("")}}function x(){return'<div class="tgrid-resize-proxy"></div>'}function d(){var C=[];C.push('<div class="tgrid-loading-bg"></div>');C.push('<div class="tgrid-loading-box"><span>正在加载...</span></div>');return C.join("")}function g(C,D){this.bgEl=C;this.loadingBox=D}g.prototype.show=function(){this.bgEl.addClass("loading-bg-opacity").show();this.loadingBox.show()};g.prototype.hide=function(){this.bgEl.removeClass("loading-bg-opacity").hide();this.loadingBox.hide()};g.prototype.showBg=function(){this.bgEl.show()};g.prototype.getBg=function(){return this.bgEl};function y(H,F){var I=null,E=H.cells;for(var G=0,C=E.length;G<C;G++){var D=E[G].className;if(D&&D.indexOf(F)!==-1){I=E[G];break}}return I}function w(D){var C=[],E=function(H){for(var G=0,F=H.length;G<F;G++){C.push(H[G]);if(f.type(H[G].children)==="array"){if(H[G].children.length){E(H[G].children)}}}};E(D);return C}function t(D,E){var C=false;for(var F=0;F<D.length;F++){if(D[F].id===E.id){C=true;break}}return C}var h=function(C,D,E){this.grid=C;this.data=D;this.dom=E;this.opt=C.opt};h.prototype={constructor:h,expand:function(N){if(typeof N==="undefined"){N=true}N=!!N;var T=this.data,Q=[],C=this.grid,E=this.dom,D=E.view1,J=E.view2,R,I,H;if(f.type(T.children)!=="array"){return}if(T.children.length===0){return}if(this.opt.treeFieldPlace==="view1"){R=f(D)}else{if(this.opt.treeFieldPlace==="view2"){R=f(J)}}T.expand=N;Q=w(T.children);for(var O=0;O<Q.length;O++){var S=Q[O],G=t(T.children,S),P=C._getTrDom(S),K=P.view1,F=P.view2,M=K.style.display,L=F.style.display;if(N===false){K.setAttribute("data-status",M);F.setAttribute("data-status",L);K.style.display="none";F.style.display="none"}else{if(G){K.style.display="";F.style.display=""}else{K.style.display=K.getAttribute("data-status");F.style.display=F.getAttribute("data-status")}}}if(R){I=R.find(".tree-hit");H=f(I.get(0).nextSibling);if(!N){I.removeClass("tree-expanded").addClass("tree-collapsed");H.removeClass("tree-folder-open")}else{I.removeClass("tree-collapsed").addClass("tree-expanded");H.addClass("tree-folder-open")}}this.grid.view1Tbody.scrollTop(this.grid.view2Tbody.scrollTop());this.opt.onExpand.call(this,this,N)},remove:function(){},select:function(C){var E=this.grid,D=this.opt,F=this.dom;if(C===false){f(F.view1).removeClass("tgrid-row-selected");f(F.view2).removeClass("tgrid-row-selected");if(D.gridCheckBox){f(F.view1).find(".tgrid-checkbox").removeClass("tgrid-checkbox-checked")}if(D.gridRadio){f(F.view1).find(".tgrid-radio").removeClass("tgrid-radio-checked")}E._deleteSelectedData(this.data)}else{if(D.gridCheckBox===false&&D.gridRadio===true){E.view1Table.find(".tgrid-row").removeClass("tgrid-row-selected");E.view2Table.find(".tgrid-row").removeClass("tgrid-row-selected");E.view1Table.find(".tgrid-radio").removeClass("tgrid-radio-checked")}f(F.view1).addClass("tgrid-row-selected");f(F.view2).addClass("tgrid-row-selected");if(D.gridCheckBox){f(F.view1).find(".tgrid-checkbox").addClass("tgrid-checkbox-checked")}else{if(D.gridRadio){f(F.view1).find(".tgrid-radio").addClass("tgrid-radio-checked")}}E._pushSelectedData(this.data)}this.opt.onSelect.call(this,this,C)},firstChild:function(){},lastGrandChild:function(){var F=this.data,E=[],D,C;if(F.children){if(F.children.length){E=w(F.children);D=E[E.length-1]}else{return this}}else{return this}C=this.grid._getTrDom(D);return new h(this.grid,D,C)},children:function(){},parent:function(){var C=this.data._pid_,D,E=null;if(C==="-1"){D={children:this.grid._data}}else{D=this.grid.idToDataMap[C];E=this.grid._getTrDom(D)}return new h(this.grid,D,E)},hasChild:function(){},isChildOf:function(){},isDescendantOf:function(){},move:function(){},addChildren:function(H){var C=this.grid,F=this.data,K=true;if(f.type(H)!=="array"){C._loadingBox.hide();return}var J=this.lastGrandChild().getDom(),G=J.view1.nextSibling,E=J.view2.nextSibling,D=f.extend(true,[],H);if(f.type(F.children)==="array"){if(F.children.length===0){K=false}F.children=F.children.concat(D)}else{K=false;F.children=D}if(F.isLazy){K=true}C._processData();var I=C._buildTrFragment(D);J.view1.parentNode.insertBefore(I.view1,G);J.view2.parentNode.insertBefore(I.view2,E);this._switchIcon(K);C._reFlowRowNum(G);C._loadingBox.hide();I=J=G=E=null},_switchIcon:function(D){if(D===false){var C,G=this.dom,F=G.view1,E=G.view2;if(this.opt.treeFieldPlace==="view1"){C=f(F)}else{if(this.opt.treeFieldPlace==="view2"){C=f(E)}}C.find(".tree-icon").removeClass("tree-file").addClass("tree-folder tree-folder-open").before('<span class="tree-hit tree-expanded"></span>')}},removeChild:function(E){var G=E.getData(),D=this.data.children,J=[],L=E.getDom(),C=this.grid;if(f.type(G.children)==="array"){J=w(G.children)}for(var H=0,I=J.length;H<I;H++){var K=J[H],F=C._getTrDom(K);F.view1.parentNode.removeChild(F.view1);F.view2.parentNode.removeChild(F.view2);C._deleteSelectedData(K)}L.view1.parentNode.removeChild(L.view1);L.view2.parentNode.removeChild(L.view2);C._deleteSelectedData(G);for(H=0;H<D.length;H++){if(D[H].id===G.id){D.splice(H,1);break}}C._processData();C._reFlowRowNum();C._refreshSelectedData()},getData:function(){return this.data},getDom:function(){return this.dom},getRowNum:function(){return this.data._rowIndex_}};var a,j;a=function(C){this.opt=f.extend(true,{},v,C);this._wrapOptions();this._init()};j={constructor:a,_wrapOptions:function(){var D=this.opt,J=D.columnsHeader,C=D.forzenColumnsHeader,G,L=[],K=D.resizeWidth.call(null),H=D.resizeHeight.call(null);if(typeof K==="number"){D.width=K}if(typeof H==="number"){D.height=H}D.width-=2;D.height-=2;if(D.pager){D.pager=f.extend({},i,D.pager)}if(D.gridCheckBox){L.push({field:"gridCheckBox__",width:D.gridCheckBoxWidth})}else{if(D.gridRadio){L.push({field:"gridRadio__",width:D.gridCheckBoxWidth})}}if(D.rowNum){L.push({field:"gridRowNum__",width:D.rowNumWidth})}if(C.length===0&&J.length){for(G=0;G<J.length;G++){C.push([])}}for(var F=0,I=L.length;F<I;F++){for(var E=0;E<C.length;E++){C[E].splice(0,0,L[F])}}this._processColumnWidth()},_processColumnWidth:function(){var F,G=0,H=0,I=[],J={},E=this.opt,L=E.forzenColumnsHeader[E.forzenColumnsHeader.length-1],K=E.columnsHeader[E.columnsHeader.length-1],C=function(M){for(F=0;F<M.length;F++){if(!M[F].width||M[F]._auto_===true){I.push(M[F]);G++}else{H+=M[F].width;J[M[F].field]=M[F].width-9}}};C(L);C(K);if(H>=E.width){for(F=0;F<I.length;F++){I[F].width=150;J[I[F].field]=141;I[F]._auto_=true}}else{if(G!==0){var D=(E.width-H-20)/G;D=D<50?50:D;for(F=0;F<I.length;F++){I[F].width=D;J[I[F].field]=D-9;I[F]._auto_=true}}}this.columnWidthMap=J},_init:function(){var D={},C=this.opt.pager;if(C){D.pageNo=C.pageno;D.pageSize=C.pagesize}this._calLayout();this._createLayoutDom();this._parseMarkup();this.opt.datasource.call(this,this,D)},_calLayout:function(){this.opt.layout=f.extend(s(this.opt),A(this.opt))},_reLayout:function(){var C=this.opt,D;this._calLayout();D=C.layout;this.container.css({width:C.width,height:C.height});this.view1.width(D.view1Width);this.view1Theader.css({width:D.view1Width,height:D.headerHeight});this.view1Tbody.css({width:D.view1Width,height:D.bodyHeight});this.view1Footer.css({width:D.view1Width,display:D.footerHeight===0?"none":"block"});this.view2.width(D.view2Width);this.view2Theader.css({width:D.view2Width,height:D.headerHeight});this.view2Tbody.css({width:D.view2Width,height:D.bodyHeight});this.view2Footer.css({width:D.view2Width,display:D.footerHeight===0?"none":"block"})},_createLayoutDom:function(){var C=B.createElement("div");C.innerHTML=q(this.opt);this.div=C},_parseMarkup:function(){var C=f(this.div);this.container=C.find(".tgrid-view");this.view1=C.find(".tgrid-view1");this.view1Theader=this.view1.find(".tgrid-header");this.view1Tbody=this.view1.find(".tgrid-body");this.view1TbodyInner=this.view1Tbody.find(".tgrid-body-inner");this.view1TableWrap=this.view1TbodyInner.find(".tgrid-table-wrap");this.view1Footer=this.view1.find(".tgrid-footer");this.view1FooterInner=this.view1.find(".tgrid-footer-inner");this.view2=C.find(".tgrid-view2");this.view2Theader=this.view2.find(".tgrid-header");this.view2Tbody=this.view2.find(".tgrid-body");this.view2TbodyInner=this.view2Tbody.find(".tgrid-body-inner");this.view2TableWrap=this.view2TbodyInner.find(".tgrid-table-wrap");this.view2Footer=this.view2.find(".tgrid-footer");this.view2FooterInner=this.view2Footer.find(".tgrid-footer-inner");this.resizeProxy=C.find(".tgrid-resize-proxy");this.pagerContainer=C.find(".tgrid-pager");this._loadingBox=new g(C.find(".tgrid-loading-bg"),C.find(".tgrid-loading-box"));this.lineHeight=this.opt.lineHeight;this.selectedData=[]},_processData:function(){var E=0,C={},F=[],D=this.opt.treeField!=="",H=function(K){for(var J=0,I=K.length;J<I;J++){K[J].__show__=false;if(f.type(K[J].children)==="array"){if(K[J].children.length){H(K[J].children)}}}},G=function(J,M,L){var O=M+"_";for(var K=0,N=J.length;K<N;K++){var P=O+K,Q=J[K],R,I=(900*n.random()+100).toString().replace(".","");Q._stackIndex_=P;Q._pid_=L;Q._rowIndex_=++E;if(!Q.id){Q.id=I}C[Q.id]=Q;F.push(Q.id);if(f.type(Q.children)==="array"){if(Q.children.length){Q.isFolder=true;if((Q.expand===false||Q.expand==="false")&&D){H(Q.children)}G(J[K].children,P,J[K].id)}}}};G(this._data,"0","-1");this._orderList=F;this.idToDataMap=C},_initContent:function(){var E=this._data,D=this._orderList,F=0;if(D.length){F=this.idToDataMap[D[D.length-1]]._rowIndex_}var G=b(this._orderList,this.idToDataMap,this.opt),K=this,C=this.view1TableWrap.get(0),J=this.view2TableWrap.get(0),I={el:this.pagerContainer,count:this.totalCount===0?F:this.totalCount,on_page_change:function(M,L){K._pageChangeHandler(M,L);this.setPageSize(L).reDraw()}},H=k(this._footerData,this.opt);if(H){this.view1FooterInner.get(0).innerHTML=H.view1;this.view2FooterInner.get(0).innerHTML=H.view2}if(this.opt.pager){I=f.extend(this.opt.pager,I);this.pager=new a.Pager(I)}C.innerHTML=G.view1;J.innerHTML=G.view2;this.view1Table=f(C.firstChild);this.view2Table=f(J.firstChild)},_pageChangeHandler:function(D,C){this.opt.datasource.call(this,this,{pageNo:D,pageSize:C})},_getData:function(C){C=C.replace("view1","").replace("view2","");return this.idToDataMap[C]},_getTrDom:function(E){var F=E.id,D=B.getElementById(F+"view1"),C=B.getElementById(F+"view2");return{view1:D,view2:C}},_collapse:function(G,C){var F=this._getData(G),E=this._getTrDom(F);var D=new h(this,F,E);D.expand(C)},_lazyLoadData:function(D){var F=this._getData(D),C=this.opt.onLazyLoad,E=new h(this,F,this._getTrDom(F));if(typeof C==="function"){this._loadingBox.show();C.call(E,E)}},_buildTrFragment:function(I){var H=[],G=[],F=B.createElement("div"),D=B.createElement("div");u(I,this.opt,H,G);F.innerHTML="<table><tbody>"+H.join("")+"</tbody></table>";D.innerHTML="<table><tbody>"+G.join("")+"</tbody></table>";var C=B.createDocumentFragment(),J=B.createDocumentFragment(),E;while((E=F.firstChild.firstChild.firstChild)){C.appendChild(E);J.appendChild(D.firstChild.firstChild.firstChild)}H=G=F=D=null;return{view1:C,view2:J}},_reFlowRowNum:function(J){if(this.opt.rowNum){var K=J;if(!K){var M=this.view1Table.get(0).rows,L=this.view2Table.get(0).rows;for(var F=0,H=M.length;F<H;F++){var C=M[F].getAttribute("id"),G=this._getData(C)._rowIndex_,E=y(M[F],"tgrid-td-rownumber");if(E){E.firstChild.innerHTML=G}}}else{while(K){var I=this._getData(K.getAttribute("id"))._rowIndex_,D=y(K,"tgrid-td-rownumber");if(!D){break}D.firstChild.innerHTML=I;K=K.nextSibling}}}},_doDefer:function(G){var F=this.lastCall,E=(new Date()).getTime(),D=this,C=50;if(F&&E-F<C){e.clearTimeout(this.defer);this.defer=e.setTimeout(function(){D._doDefer(G)},C);return}else{this.lastCall=E}G()},_scrollLoadData:function(){},_bindEvent:function(){var D=this,C=this.container;this.offsetLeft=C.get(0).getBoundingClientRect().left;this.view2Bottom=this.view2Tbody.get(0).getBoundingClientRect().bottom;this.view2Tbody.unbind().bind("scroll",function(){var F=f(this).scrollLeft(),E=f(this).scrollTop();D.view2Theader.scrollLeft(F);D.view2Footer.scrollLeft(F);D.view1Tbody.scrollTop(E);if(D.bigData){D._doDefer(D._scrollLoadData)}});C.undelegate().delegate(".tree-hit","click",function(){D._collapseHanlder(this);return false});C.delegate(".tgrid-checkbox","click",function(){D._selectHanlder(this,"checkbox");return false});C.delegate(".tgrid-radio","click",function(){D._selectHanlder(this,"radio");return false});C.delegate(".checkbox-checkall","click",function(){D._selectAllHanlder(this);return false});C.delegate(".tgrid-row","click",function(){var F=D._getData(this.getAttribute("id")),E=new h(D,F,D._getTrDom(F));D.opt.onRowClick.call(E,E,F._rowIndex_)});C.delegate(".tgrid-resize-holder","mousedown",function(G){var H=D._loadingBox,F=G.pageX-D.offsetLeft,E={startPosition:F,field:this.getAttribute("field"),view:this.getAttribute("view")};D.resizeProxy.css("left",F).data("startInfo",E).show();H.showBg();H.getBg().addClass("tgrid-resize-cursor").off().on("mousemove",function(I){D.resizeProxy.css("left",I.pageX-D.offsetLeft);return false}).on("mouseup mouseout",function(){H.hide();H.getBg().removeClass("tgrid-resize-cursor").off();var I=D.resizeProxy.hide().data("startInfo");I.endPosition=parseInt(D.resizeProxy.css("left"),10);D.resizeColumn(I);return false});return false});this._winWidth=f(e).width();this._winHeight=f(e).height();f(e).bind("resize.TreeGrid",function(){e.clearTimeout(D._resizeTimer);D._resizeTimer=e.setTimeout(function(){D._doResize()},100)})},_doResize:function(){var E=f(e).width(),F=f(e).height();if(E===this._winWidth&&F===this._winHeight){return}var C=this.opt.resizeWidth.call(null),D=this.opt.resizeHeight.call(null);this._winWidth=E;this._winHeight=F;this.resize(C,D)},_collapseHanlder:function(H){var E=f(H).hasClass("tree-expanded"),D=f(H).hasClass("tree-lazyload"),G=H.nextSibling,F=H.parentNode.parentNode.parentNode,I=F.getAttribute("id"),C=this;if(D){f(H).removeClass("tree-lazyload");C._lazyLoadData(I);if(E){f(H).removeClass("tree-expanded").addClass("tree-collapsed");f(G).removeClass("tree-folder-open")}else{f(H).removeClass("tree-collapsed").addClass("tree-expanded");f(G).addClass("tree-folder-open")}}else{C._collapse(I,!E)}},_deleteSelectedData:function(F){var D=false;for(var E=0,C=this.selectedData.length;E<C;E++){if(this.selectedData[E].id===F.id){this.selectedData.splice(E,1);D=true;break}}if(D){f(".checkbox-checkall",this.view1Theader).removeClass("checkbox-checkall-checked")}},_pushSelectedData:function(C){if(this.opt.gridCheckBox){this.selectedData.push(C)}else{if(this.opt.gridRadio){this.selectedData=[C]}}if(this.selectedData.length===this._orderList.length){f(".checkbox-checkall",this.view1Theader).addClass("checkbox-checkall-checked")}},_selectHanlder:function(J,G){var D="tgrid-"+G+"-checked",C=f(J),F=C.hasClass(D),E=J.parentNode.parentNode.getAttribute("id"),I=this._getData(E),H=new h(this,I,this._getTrDom(I));H.select(!F)},_selectAllHanlder:function(F){var C=f(F),D="checkbox-checkall-checked",E=C.hasClass(D);if(E){C.removeClass(D);this.view1Table.find(".tgrid-checkbox").removeClass("tgrid-checkbox-checked");this.view1Table.find(".tgrid-row").removeClass("tgrid-row-selected");this.view2Table.find(".tgrid-row").removeClass("tgrid-row-selected");this.selectedData=[]}else{C.addClass(D);this.view1Table.find(".tgrid-checkbox").addClass("tgrid-checkbox-checked");this.view1Table.find(".tgrid-row").addClass("tgrid-row-selected");this.view2Table.find(".tgrid-row").addClass("tgrid-row-selected");this.selectedData=this._getAllParallelData()}this.opt.onSelectAll.call(this,this.selectedData,!E)},_refreshSelectedData:function(){var D=this.selectedData,C=this.idToDataMap;for(var E=0;E<D.length;E++){D[E]=C[D[E].id]}},_getAllParallelData:function(){var D=this.idToDataMap,F=[],G=this._orderList;for(var E=0,C=G.length;E<C;E++){F.push(D[G[E]])}return F},resizeColumn:function(F){var I=F.endPosition-F.startPosition,C=this.columnWidthMap[F.field],D=C+I,K=this;if(C<=50&&I<=0){return}if(D<50){D=50;I=D-C}this.columnWidthMap[F.field]=D;if(F.view==="view1"){var H=this.view1.width(),G=this.view2.width(),J=H+I,E=G-I;this.view1.width(J);this.view1Theader.width(J);this.view1Tbody.width(J);this.view1Footer.width(J);this.view2.width(E);this.view2Theader.width(E);this.view2Tbody.width(E);this.view2Footer.width(E)}this._modifyStyle()},_buildCssString:function(){var D="",C=this.columnWidthMap;for(var E in C){if(C.hasOwnProperty(E)){D+="."+m+E+"{width:"+C[E]+"px;}\n"}}return D},_createStyle:function(){var C="tgridstyle"+(900*n.random()+100).toString().replace(".",""),D='<style type="text/css" id="'+C+'">';D+=this._buildCssString();D+="</style>";f(this.div).append(D);this.styleId=C},_modifyStyle:function(){var C="tgridstyle"+(900*n.random()+100).toString().replace(".",""),D='<style type="text/css" id="'+C+'">';D+=this._buildCssString();D+="</style>";f("#"+this.styleId).remove();this.container.append(D);var E=this.view2Tbody.scrollLeft();this.view2Theader.scrollLeft(E);this.view2Footer.scrollLeft(E);this.styleId=C},_startBigData:function(){},setDatasource:function(D){var C=f.type(D);if(C==="array"){this._data=D;this.totalCount=0}else{if(C==="object"){this._data=D.rows;this.totalCount=D.totalCount;if(this.opt.footer){if(!D.footer){this._footerData=[{}]}else{this._footerData=D.footer}}}}this._processData();this._startBigData();this._initContent();this._render();return this},getDatasource:function(){var C={};C.rows=f.extend(true,[],this._data);C.totalCount=this.totalCount;if(this._footerData){C.footer=f.extend(true,[],this._footerData)}return C},_render:function(){if(this.rendered){return}this.rendered=true;var C=this,E=B.getElementById(this.opt.containerId);E.innerHTML="";this._createStyle();var D=B.createDocumentFragment(),F=this.div;while(F.firstChild){D.appendChild(F.firstChild)}E.appendChild(D);this.div=null;e.setTimeout(function(){C._bindEvent()},0)},getSelectedData:function(){return this.selectedData},getNodeById:function(F){var E=this._data,C=this.idToDataMap[F],D=null;if(C){D=new h(this,C,this._getTrDom(C))}return D},getSelectedNode:function(){var D,E=[];for(D=0;D<this.selectedData.length;D++){var C=this.selectedData[D];E.push(new h(this,C,this._getTrDom(C)))}return E},resize:function(E,G){var F=this.opt,H,D,I=F.height,C=F.width;if(typeof E==="number"){H=E-2;F.width=H}if(typeof G==="number"){D=G-2;F.height=D}if(F.width!==C){this._processColumnWidth();this._modifyStyle()}if(F.width!==C||F.height!==I){this._reLayout()}}};a.prototype=j;a.listToTree=function(F,C,I){var N=[],K={};for(var G=0,L=F.length;G<L;G++){var M=F[G];M.children=[];K[M[C].toString()]=M}for(var D=0,J=F.length;D<J;D++){var E=F[D],H=K[E[I].toString()];if(typeof H==="undefined"){N.push(E)}else{H.children.push(E)}}return N};a.scan=function(G){var P=f(G),M=P.find("thead"),F=P.get(0),C=[],K=[],L="tree-grid-"+(900*n.random()+100).toString().replace(".",""),R={};var D=B.createElement("div");D.setAttribute("id",L);F.parentNode.insertBefore(D,F);P.hide();for(var E in v){if(v.hasOwnProperty(E)){var Q=F.getAttribute(E),J=null,O=null,N=f.type(v[E]);if(Q){R[E]=Q;switch(N){case"number":R[E]=parseInt(Q,10);break;case"boolean":R[E]=Q!=="false";break;case"function":J=Q.split(".");for(var I=0;I<J.length;I++){if(!O){O=e[J[I]]}else{O=O[J[I]]}}R[E]=O;break;default:}}}}R.containerId=L;M.each(function(){var S=f(this).attr("frozen");f(this).find("tr").each(function(){var T=[];f(this).find("th").each(function(){var U=this.getAttribute("width"),V=this.getAttribute("colspan");U=U?parseInt(U,10):U;V=V?parseInt(V,10):V;T.push({name:this.innerHTML,width:U,align:this.getAttribute("align"),colspan:V,field:this.getAttribute("field")})});if(S==="true"){C.push(T)}else{K.push(T)}})});R.columnsHeader=K;if(C.length){R.forzenColumnsHeader=C}var H=new a(R);P.data("treeGrid",H);return H};a.getObject=function(C){return f(C).data("treeGrid")};a.version="v1.0-beta1-build20140312";e.TreeGrid=a})(window.jQuery);(function(c){var b=function(d){this.options=c.extend(true,{},this.options,d);this._init()};var a={options:{el:"",count:0,display_page:4,pagesize:25,pageno:1,pagesize_list:[25,50,100],on_page_change:function(){}},_init:function(){this.$container=c(this.options.el).addClass("grid-pagination");this.setInitData();this._create()},_buildTemplateStr:function(g){var f=[],e=g.selectList;f.push('<div class="right-side">');if(g.currentPage!==1){f.push('<a href="#" class="page-prev" act="prevPage">上一页</a>')}f.push("<span>",g.currentPage,"/",g.totalPage,"</span>");if(g.currentPage!==g.totalPage){f.push('<a href="#" class="page-next" act="nextPage">下一页</a>')}f.push("<span>跳转至</span><span>");f.push('<input type="text" act="cusPage" class="page-skip-num" value="',g.currentPage);f.push('" maxlength="',g.totalPage.toString().length,'"/>');f.push("</span><span >页</span>");f.push('<a href="#" class="btn-normal" act="goPage">GO</a> </div>');f.push("<div>");if(e&&e.length>0){f.push("<span>共",g.totalItems,"条记录</span><span>每页显示:</span>");for(var d=0;d<e.length;d++){if(e[d]===g.itemsPerPage){f.push('<span><em class="pagesize-selected">',e[d],"</em></span>")}else{f.push('<a href="#" class="page-size" act="sizePage">',e[d],"</a>")}}f.push("<span>条</span>")}f.push("</div>");return f.join("")},_create:function(){if(this.totalItems<=0){this.$container.empty();return}this._calTotalPage();this._draw();this._bindEvent()},_draw:function(){var i=this.options.display_page,f=this.totalPage,h=this.currentPage;if(i>f){i=f}if(i<=3){i=3}var d=Math.floor((i-1)/2),k=Math.ceil((i-1)/2);if(h-2<d){k=k+d-(h-2)}else{if(f-h-1<k){d=d+k-(f-h-1)}}if(d>h-1){d=h-1}if(k>f-h){k=f-h}var e=h-d,g=h+k;var j={totalItems:this.totalItems,totalPage:f,currentPage:h,itemsPerPage:this.itemsPerPage,selectList:this.options.pagesize_list,displayPreCount:d,displayNextCount:k,toFirst:e,toLast:g};this.$container.html(this._buildTemplateStr(j))},_bindEvent:function(){var d=this,e=this.$container;e.unbind().bind("click",function(i){var h=c(i.target),g=h.attr("act");switch(g){case"numPage":d.go(parseInt(h.text(),10));break;case"prevPage":d.prev();break;case"nextPage":d.next();break;case"goPage":f();break;case"sizePage":d._setItemsPerPage(parseInt(h.text(),10));d._calTotalPage();d.go(d.currentPage);break;default:}return false});e.find('[act="cusPage"]').bind("keydown",function(g){if(g.keyCode===13){f()}});function f(){var g=parseInt(d.$container.find(".page-skip-num").val(),10);if(isNaN(g)||g<=0){g=1}if(g>d.totalPage){g=d.totalPage}d.go(g);return false}},_calTotalPage:function(){this.totalPage=Math.ceil(this.totalItems/this.itemsPerPage);if(this.currentPage>=this.totalPage){this.currentPage=this.totalPage}},reDraw:function(){this._create();return this},setCount:function(d){this.options.count=this.totalItems=d;return this},setPageSize:function(h){if(typeof h!=="number"||h<=0){return this}var g=false,j=this.options.pagesize_list;for(var f=0,d=j.length;f<d;f++){if(j[f]===h){g=true;break}}this.itemsPerPage=this.options.pagesize=h;if(!g){var e=c.extend([],j);e.push(h);e.sort(function k(l,i){return l-i});e.splice(3,1);this.options.pagesize_list=e}this.reDraw();return this},setInitData:function(){var g=this.options;this.totalItems=g.count!==null?g.count:null;this.itemsPerPage=g.pagesize!==null?g.pagesize:null;this.currentPage=g.pageno!==null?g.pageno:null;this.currentPage=g.pageno=g.pageno<1?1:g.pageno;this.itemsPerPage=g.pagesize=g.pagesize<1?g.pagesize_list[1]:g.pagesize;var d=true;for(var e=0;e<g.pagesize_list.length;e++){var f=g.pagesize_list[e];if(f<1){g.pagesize_list.splice(e,1);e--;continue}if(f===this.itemsPerPage){d=false}}if(d){g.pagesize_list.push(this.itemsPerPage);g.pagesize_list.sort(function(i,h){return i-h})}return this},go:function(d){if(typeof d!=="number"){return this}if(d>this.totalPage){d=this.totalPage}this.options.pageno=this.currentPage=d;this._click(d,this.itemsPerPage);return this},next:function(){if(this.currentPage===this.totalPage){return this}this.currentPage++;this.options.pageno=this.currentPage;this._click(this.currentPage,this.itemsPerPage);return this},prev:function(){if(this.currentPage===1){return this}this.currentPage--;this.options.pageno=this.currentPage;this._click(this.currentPage,this.itemsPerPage);return this},getCurrentPage:function(){return this.currentPage},setPageSizeList:function(g,f){if(c.type(g)!=="array"){return this}if(typeof f!=="number"||f<=0){f=this.options.pagesize}this.options.pagesize_list=c.extend(true,this.options.pagesize_list,g);this.options.pagesize_list.splice(3);var e=false;for(var d=0;d<this.options.pagesize_list.length;d++){if(this.options.pagesize_list[d]===f){e=true;break}}this.itemsPerPage=this.options.pagesize=e?f:this.options.pagesize_list[1];this.reDraw();return this},_click:function(e,d){this.options.on_page_change.call(this,e,d)},_setItemsPerPage:function(d){this.itemsPerPage=d}};b.prototype=a;window.TreeGrid.Pager=b})(window.jQuery);